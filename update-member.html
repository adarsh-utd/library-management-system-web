<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Member Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        const pathQ = window.location.href.split("=");
        const memberId = pathQ[pathQ.length - 1];
        const userStorageData = localStorage.getItem("userData");
        var userData = JSON.parse(userStorageData);
        function getBookById(event) {

            fetch(`https://library-management-system-api-35083192508e.herokuapp.com/members/${memberId}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${userData.access_token}`
                },

            })
                .then((response) => {
                    if (response.status == 401) {
                        localStorage.removeItem("userData");
                        window.location.href = 'index.html';
                        return;
                    }

                    if (!response.ok) {
                        console.log(response);
                        alert("Something went wrong");
                    }
                    return response.json();
                })
                .then((result) => {
                    document.getElementById('username').value = result.member.username || '';
                    document.getElementById('email').value = result.member.email || '';
                    document.getElementById('address').value = result.member.address || '';
                    document.getElementById('userType').value = result.member.user_type || '';
                })
        }
        function clickSave(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const userType = document.getElementById('userType').value;
            const email = document.getElementById('email').value;
            const address = document.getElementById('address').value;
            var userData = localStorage.getItem("userData");
            var userData = JSON.parse(userData);

            fetch(`https://library-management-system-api-35083192508e.herokuapp.com/members/${memberId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${userData.access_token}`
                },
                body: JSON.stringify({
                    username: username,
                    email: email,
                    address: address,
                    user_type: userType

                }),
            })
                .then((response) => {
                    if (response.status == 401) {
                        localStorage.removeItem("userData");
                        window.location.href = 'index.html';
                        return;
                    }
                    return response.json().then((result) => {
                        console.log(response)
                        if (response.ok) {

                            alert(result.message);
                            window.location.href = 'member.html';
                        } else {
                            alert(result.detail);
                        }

                    })
                })

                .catch((error) => {
                    console.error('Error:', error);
                    alert("An error occurred. Please try again.");
                });
        }
        document.addEventListener("DOMContentLoaded", getBookById);
    </script>
</head>

<body>
    <h1 class="row justify-content-center mt-3">Update Member</h1>
    <p class="row justify-content-center text-secondary">Please fill the form to update member</p>
    <div class="container mt-2">

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <form id="registrationForm" action="">
                            <div class="form-group">
                                <label for="username">
                                    Member Name
                                </label>
                                <input type="text" class="form-control" id="username" placeholder="Member Name"
                                    required />
                            </div>
                            <div class="form-group">
                                <label for="username">
                                    Member Email
                                </label>
                                <input type="email" class="form-control" id="email" placeholder="Member email"
                                    required />
                            </div>
                            <div class="form-group">
                                <label for="address">
                                    Member Address
                                </label>
                                <input type="text" class="form-control" id="address" placeholder="Member Address"
                                    required />
                            </div>

                            <div class="form-group mt-2">
                                <label for="userType">
                                    User Type
                                </label>
                                <select class="form-select" aria-label="Default select example" id="userType" required>
                                    <option value="member" selected>Member</option>
                                </select>
                            </div>
                            <button class="btn btn-info mt-2 text-white" onClick=clickSave(event)>
                                Save
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>